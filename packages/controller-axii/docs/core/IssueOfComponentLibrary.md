# 组件的主要领域问题

界定范围：通用组件，本质上是对一些"常用逻辑"进行封装处理，面临的主要问题是：使用者在运行时各种差异的需求。
因此主要问题一：如何尽量少工作量地支持好差异化需求。主要是通过 createComponent 实现。

问题二：在编写通用组件时，支持的需求越多，组件就会越大越难维护，如何尽量语义化让代码即需求。(模式问题)

问题三：组件在"封装功能"时，需要界定清楚自己与"全局环境"的边界。如使用 history/window 等。
同时还可能需要系统补足一些能力，例如 modal 组件，要在打开时获取鼠标点击的位置。
还有可能要对系统进行监听，例如 backToTop 监听了 scroll（参考 vue/composable，都可以变成直接生成 reactive data) 
(系统约定，副作用)

问题四：在交互领域，大的组件是由原子元素构成，在当做整体使用时，会要求原子有些不同的行为、样式，这些逻辑写在哪里？
虽然这些行为和样式是要求原子来实现，但是逻辑写在原子中就违背了"语意"。（要扩展组件能力）

问题五：在交互领域，组件的在外观上可能是分布式的，如何表达界面上的分布？（要扩展组件能力）

问题六：没有实际 UI 元素的能力，应该以什么形似来承载？在 react 中也是组件和 render props。
解：用 hooks 的方式来解，例如 form/mouse position/scroll

问题七：因为 dom 这个 UI 环境的原因，有些组件需要用到 width 等排版后才知道的数据，怎么处理？
也考虑用 hooks???

问题八：有的组件需要展开 modal。
其实本质上也是对"系统"能力的一种需求。

问题九：交互层面对"浮层"的需求。
从用户角度看，modal/popup/message/tooltip 是明确的浮层。但 calendar/selector 的展开，去并不是那么明确，用户可能都没有意识到。
这里的区别在于，modal/popup 里要表达的元素本来就不存在，他们和触发他们的组件也不是一个边界完成的同一个组件。
但 calendar/selector 则不同，它们和浮层在一起在能完成组件的功能，明确地"是同一个组件"。

## 问题三
对全局的依赖，需要通过接口声明，这样由系统可以提供机制进行覆盖。
目的是为了减少冲突，也能创造沙箱进行测试。
组件自身不去和系统做约定，因为从 props 去传递等不符合组件本身的语意。
组件通过 util 来使用系统能力。
util 中去和系统做约定。从 context 中？？这样就能复写 util 的行为或者做测试了。
TODO 但又设计到深层修改 context 的问题，context 中怎么再去处理子的？


## 问题四
TODO 理论上应该写在组合组件上，这就要求原子组件的能力和行为能够被覆写。

## 问题五
TODO 使用函数生成分散的 vnode 节点，然后再进行使用？？？或者像 hooks 一样，生成绑定好的 vnode 节点，供用户使用。
自己没有独立的生命周期。

## 问题六，没有实际 UI 元素的能力例子
1. anchor 和自己的 link
2. form 和自己的 items

## 问题七
TODO useRenderedLayout???

## 问题八
本质上是对系统能力的一种需求，即"使用系统的多个层次"。我们可以把一般 return 出来的 vnode 节点表示成：
默认使用当前 layer。常见的有"固定在顶层"，"上一层"。
还有可能要把下层"层级"遮罩的需求。这是另外一件事了。

而 layer 的本质，是用户在视觉上判断 "远近" 的需求，这个需求是在用户层存在的。

系统如何提供相应的能力？
1. 如何实现 layer，在 document 上创建新的 div 还是如何？
2. 提供主元素的位置信息，
3. 提供 focus 转移的能力？如果在别的 layer 显示，那么就没法通过 focusin 和 focusout 来处理了。


# 其他想法

## 组件里的数据还可以细分
虽然现在的组件都是数据驱动，但这些数据地位并不相同。一部分数据其实是"逻辑数据"，是用户在"功能"层面理解的。
例如一个 checkbox 是否选中，本后的是有业务语音——"XX 是否打开"、"是否同意"等等，只不过这些语义刚好用 checkbox 的 isChecked 来承载。
剩下的数据就是组件内部用来表达"交互"、"样式"的数据了，例如是否高亮等等。
当然逻辑数据和其他数据并没有明确的边界，我们也可以为"是否高亮"赋予一定的业务语义，这就取决于具体情况了。
